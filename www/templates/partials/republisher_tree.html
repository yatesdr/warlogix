{{define "republisher_tree.html"}}
{{if .PLCs}}
{{range .PLCs}}
<div class="plc-group" id="plc-{{.Name}}" data-plc="{{.Name}}" data-manual-tags="{{.AllowManualTags}}">
    <div class="plc-header-bar">
        <div class="plc-header-info">
            <span class="status-dot {{.StatusClass}}"></span>
            <span class="plc-name">{{.Name}}</span>
            {{if .Address}}<span class="plc-detail">{{.Address}}</span>{{end}}
            {{if .Family}}<span class="plc-detail plc-family">{{.Family}}</span>{{end}}
            {{if .ProductName}}<span class="plc-detail">{{.ProductName}}</span>{{end}}
            {{if .ConnectionMode}}<span class="plc-detail plc-connmode">{{.ConnectionMode}}</span>{{end}}
        </div>
        <div class="plc-header-actions">
            <span class="tag-count">{{.TagCount}} tags</span>
            {{if .AllowManualTags}}<button class="btn-icon btn-add-tag" title="Add Tag" onclick="showAddTagModal('{{.Name}}')">+</button>{{end}}
        </div>
    </div>
    <div class="plc-tags">
        {{if .Sections}}
        {{range .Sections}}
        <div class="section-group" data-section="{{.Name}}">
            <div class="section-header" onclick="toggleSection(this)">
                <span class="section-expand">&#9660;</span>
                <span class="section-name">{{.Name}}</span>
                <span class="section-count">({{len .Tags}})</span>
            </div>
            <div class="section-tags">
                {{range .Tags}}
                <div class="tag-item{{if .IsStruct}} has-children collapsed{{end}}"
                     data-name="{{.Name}}"
                     data-type="{{.Type}}"
                     data-value="{{.Value}}"
                     data-json="{{.JSONValue}}"
                     data-alias="{{.Alias}}"
                     data-writable="{{.Writable}}"
                     data-enabled="{{.Enabled}}"
                     data-is-struct="{{.IsStruct}}"
                     data-field-count="{{.FieldCount}}"
                     data-has-ignores="{{.HasIgnores}}"
                     data-ignore-count="{{.IgnoreCount}}"
                     data-ignore-list="{{json .IgnoreList}}"
                     data-published-children="{{json .PublishedChildren}}"
                     data-last-poll="{{.LastPoll}}"
                     data-last-changed="{{.LastChanged}}">
                    <div class="tag-row{{if .Enabled}} monitored{{end}}" onclick="handleTagClick(event, this)">
                        {{if .IsStruct}}<span class="tag-expand" onclick="toggleTagExpand(event, this)">&#9660;</span>{{end}}
                        <span class="tag-indicators">
                            {{if .HasIgnores}}<span class="indicator indicator-ignore" title="Has {{.IgnoreCount}} ignored members">I</span>{{end}}
                            {{if .Writable}}<span class="indicator indicator-write" title="Writable">W</span>{{end}}
                        </span>
                        <label class="publish-toggle" onclick="event.stopPropagation()" title="Toggle publishing">
                            <input type="checkbox" {{if .Enabled}}checked{{end}} onchange="quickTogglePublish(this)">
                            <span class="publish-slider"></span>
                        </label>
                        <span class="tag-name" title="{{.Name}}">{{.TreeDisplay}}</span>
                        {{if not .IsStruct}}<span class="tag-value">{{.Value}}</span>{{end}}
                    </div>
                    {{if .IsStruct}}<div class="tag-children"></div>{{end}}
                </div>
                {{end}}
            </div>
        </div>
        {{end}}
        {{else}}
        {{if .AllowManualTags}}
        <div class="tag-row empty">No tags configured. <a href="#" onclick="showAddTagModal('{{.Name}}'); return false;">Add a tag</a></div>
        {{else}}
        <div class="tag-row empty">No tags available</div>
        {{end}}
        {{end}}
    </div>
</div>
{{end}}
{{else}}
<div class="empty-state">No PLCs configured</div>
{{end}}
{{end}}
