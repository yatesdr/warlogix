{{template "header" .}}

<div class="page-header">
    <h1>User Management</h1>
    <button class="btn btn-primary" onclick="showAddUserModal()">Add User</button>
</div>

<div id="users-container" hx-get="/users/htmx" hx-trigger="every 5s" hx-swap="innerHTML">
    {{template "users_table.html" .}}
</div>

<!-- Add User Modal -->
<div id="add-user-modal" class="modal" style="display:none">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add User</h2>
            <button class="modal-close" onclick="WarLink.hideModal('add-user-modal')">&times;</button>
        </div>
        <form id="add-user-form" onsubmit="addUser(event)">
            <div class="form-group">
                <label for="new-username">Username</label>
                <input type="text" id="new-username" name="username" required>
            </div>
            <div class="form-group">
                <label for="new-password">Password</label>
                <input type="password" id="new-password" name="password" required>
            </div>
            <div class="form-group">
                <label for="new-role">Role</label>
                <select id="new-role" name="role">
                    <option value="admin">Admin</option>
                    <option value="viewer">Viewer</option>
                </select>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" onclick="WarLink.hideModal('add-user-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Add User</button>
            </div>
        </form>
    </div>
</div>

<script>
function showAddUserModal() {
    WarLink.showModal('add-user-modal');
}

function hideAddUserModal() {
    WarLink.hideModal('add-user-modal');
    document.getElementById('add-user-form').reset();
}

function addUser(e) {
    e.preventDefault();
    var form = e.target;
    var data = {
        username: form.username.value,
        password: form.password.value,
        role: form.role.value
    };
    WarLink.api.post('/users/', data)
        .then(function() {
            hideAddUserModal();
            location.reload();
        })
        .catch(function(err) {
            WarLink.toast('Error: ' + err.message, 'error');
        });
}

function deleteUser(username) {
    if (!confirm('Delete user "' + username + '"?')) return;
    WarLink.api.del('/users/' + encodeURIComponent(username))
        .then(function() {
            location.reload();
        })
        .catch(function(err) {
            WarLink.toast('Error: ' + err.message, 'error');
        });
}
</script>

{{template "footer" .}}
